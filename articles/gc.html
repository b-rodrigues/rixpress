<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Managing Cached Build Artifacts • rixpress</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Managing Cached Build Artifacts">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rixpress</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/intro-concepts.html">Introductory concepts</a></li>
    <li><a class="dropdown-item" href="../articles/scope.html">Scope and Roadmap</a></li>
    <li><a class="dropdown-item" href="../articles/core-functions.html">Core rixpress Functions and Usage</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html">Setting up a pipeline from scratch: a tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/importing-data.html">Importing Data Files</a></li>
    <li><a class="dropdown-item" href="../articles/debugging.html">Effective debugging</a></li>
    <li><a class="dropdown-item" href="../articles/gc.html">Managing Cached Build Artifacts</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Polyglot pipelines</h6></li>
    <li><a class="dropdown-item" href="../articles/polyglot.html">Polyglot pipelines and literate programming with Quarto or R Markdown</a></li>
    <li><a class="dropdown-item" href="../articles/polyglot-julia.html">Polyglot pipelines with Julia and R</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/ci.html">Running pipelines in CI</a></li>
    <li><a class="dropdown-item" href="../articles/cmdstanr.html">Using {cmdstanr} with {rixpress}</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-rodrigues/rixpress/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Managing Cached Build Artifacts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-rodrigues/rixpress/blob/main/vignettes/gc.Rmd" class="external-link"><code>vignettes/gc.Rmd</code></a></small>
      <div class="d-none name"><code>gc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Becuse <a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a> uses Nix as its build engine, every
build artifact is cached in the Nix store (<code>/nix/store</code>).
When you modify your pipeline, new artifacts are created, but the old
ones remain. This is powerful because it allows you to access a complete
history of your work. However, over time, this can lead to the Nix store
consuming a significant amount of disk space.</p>
<p>This vignette explains how to manage this cache using the
<code><a href="../reference/rxp_gc.html">rxp_gc()</a></code> function, which provides a safe and targeted way
to garbage-collect old build artifacts.</p>
</div>
<div class="section level2">
<h2 id="build-logs-the-key-to-your-pipelines-history">Build Logs: The Key to Your Pipeline’s History<a class="anchor" aria-label="anchor" href="#build-logs-the-key-to-your-pipelines-history"></a>
</h2>
<p>Before we discuss cleaning up, it’s important to understand how
<a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a> keeps track of artifacts. Every time you run
<code><a href="../reference/rxp_make.html">rxp_make()</a></code>, a detailed <strong>build log</strong> is saved
in your project’s <code>_rixpress</code> directory. These logs record
the outcome of each derivation and, crucially, the exact path to its
output in the Nix store.</p>
<p>You can see a list of all historical builds with
<code><a href="../reference/rxp_list_logs.html">rxp_list_logs()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rxp_list_logs.html">rxp_list_logs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                         filename   modification_time size_kb</span></span>
<span><span class="co">#&gt; 1 build_log_20250815_113000_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6.rds 2025-08-15 11:30:00    0.51</span></span>
<span><span class="co">#&gt; 2 build_log_20250814_170000_z9y8x7w6v5u4t3s2r1q0p9o8n7m6l5k4.rds 2025-08-14 17:00:00    0.50</span></span></code></pre></div>
<p>These logs are the foundation for debugging and retrieving historical
data. For a deep dive into how to use them for troubleshooting, please
see the <code><a href="../articles/debugging.html">vignette("debugging")</a></code>. For now, just remember that
these logs are what <code><a href="../reference/rxp_gc.html">rxp_gc()</a></code> uses to intelligently clean up
your cache.</p>
</div>
<div class="section level2">
<h2 id="cleaning-up-artifacts-with-rxp_gc">Cleaning Up Artifacts with <code>rxp_gc()</code><a class="anchor" aria-label="anchor" href="#cleaning-up-artifacts-with-rxp_gc"></a>
</h2>
<p>The <code><a href="../reference/rxp_gc.html">rxp_gc()</a></code> function is the primary tool for managing
your project’s storage footprint. It operates in two distinct modes.</p>
<div class="section level3">
<h3 id="targeted-deletion-cleaning-up-old-builds">1. Targeted Deletion: Cleaning Up Old Builds<a class="anchor" aria-label="anchor" href="#targeted-deletion-cleaning-up-old-builds"></a>
</h3>
<p>The most common use case is to remove artifacts from builds that are
no longer needed, while keeping recent ones. This is done by specifying
the <code>keep_since</code> argument. The function will identify all
build logs older than the given date and attempt to delete both the log
files and the associated Nix store paths.</p>
<p>Before deleting anything, it is <strong>highly recommended</strong>
to perform a <code>dry_run</code>. This will print a detailed report of
what actions <em>would</em> be taken, without actually modifying your
system. To avoid mistakes, this is the default behaviour of
<code><a href="../reference/rxp_gc.html">rxp_gc()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Preview what would be deleted if we keep artifacts from August 1st, 2025 onward.</span></span>
<span><span class="fu"><a href="../reference/rxp_gc.html">rxp_gc</a></span><span class="op">(</span>keep_since <span class="op">=</span> <span class="st">"2025-08-01"</span>, dry_run <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># dry_run = TRUE is actually the default</span></span></code></pre></div>
<p>The output will list the log files and Nix store paths targeted for
deletion. Once you have reviewed the plan and are confident, you can
perform the actual cleanup by setting <code>dry_run = FALSE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Keep builds from the last 30 days and delete everything older.</span></span>
<span><span class="va">thirty_days_ago</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">30</span></span>
<span><span class="fu"><a href="../reference/rxp_gc.html">rxp_gc</a></span><span class="op">(</span>keep_since <span class="op">=</span> <span class="va">thirty_days_ago</span><span class="op">)</span></span></code></pre></div>
<p>The function will prompt you for confirmation before proceeding. It
intelligently protects the artifacts from your more recent builds, so
you don’t have to worry about accidentally deleting something you still
need. Note that some paths may not be deleted if they are still
referenced by other parts of your system (like a <code>result</code>
symlink or an active <code>nix-shell</code>). <code><a href="../reference/rxp_gc.html">rxp_gc()</a></code>
handles this gracefully and will report these paths as “skipped”.</p>
</div>
<div class="section level3">
<h3 id="full-garbage-collection">2. Full Garbage Collection<a class="anchor" aria-label="anchor" href="#full-garbage-collection"></a>
</h3>
<p>If you wish to perform a complete, system-wide cleanup, you can call
<code><a href="../reference/rxp_gc.html">rxp_gc()</a></code> with no arguments.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This will trigger a full Nix garbage collection.</span></span>
<span><span class="fu"><a href="../reference/rxp_gc.html">rxp_gc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This is equivalent to running <code>nix-store --gc</code> in your
terminal. It will delete <strong>all</strong> unreferenced paths from
your Nix store, not just those related to your current project. This is
a powerful way to reclaim a large amount of disk space, but it will
remove cached artifacts for all Nix-based projects and environments on
your system. Use this option when you are certain you no longer need any
old, unreferenced build caches.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The Nix store’s caching is a powerful feature for reproducibility,
but it requires occasional maintenance. <code><a href="../reference/rxp_gc.html">rxp_gc()</a></code> provides
the tools you need to manage this cache effectively.</p>
<ul>
<li>Use <code>rxp_gc(keep_since = ...)</code> for routine,
project-specific cleanup.</li>
<li>Use <code><a href="../reference/rxp_gc.html">rxp_gc()</a></code> with no arguments for a more aggressive,
system-wide cleanup.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bruno Rodrigues.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
