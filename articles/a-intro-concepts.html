<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introductory concepts • rixpress</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introductory concepts">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rixpress</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-intro-concepts.html">Introductory concepts</a></li>
    <li><a class="dropdown-item" href="../articles/b-core-functions.html">Core rixpress Functions and Usage</a></li>
    <li><a class="dropdown-item" href="../articles/c-tutorial.html">Setting up a pipeline from scratch: a tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/d-polyglot.html">Polyglot pipelines and literate programming with Quarto or R Markdown</a></li>
    <li><a class="dropdown-item" href="../articles/e-ci.html">Running pipelines in CI</a></li>
    <li><a class="dropdown-item" href="../articles/f-cmdstanr.html">Using {cmdstanr} with {rixpress}</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-rodrigues/rixpress/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introductory concepts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-rodrigues/rixpress/blob/main/vignettes/a-intro-concepts.Rmd" class="external-link"><code>vignettes/a-intro-concepts.Rmd</code></a></small>
      <div class="d-none name"><code>a-intro-concepts.Rmd</code></div>
    </div>

    
    
<p>For a video version of this tutorial, <a href="youtube%20link%20to%20follow">click here</a>.</p>
<p>This vignette introduces key terminology and walks you through
setting up a simple pipeline using <a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a>.
Understanding the concepts presented here is helpful but not mandatory.
I recommend reading through this vignette, but don’t worry if you don’t
grasp everything immediately. You can try building a simple pipeline by
following the next vignette, <code><a href="../articles/b-core-functions.html">vignette("b-core-functions")</a></code>,
and then return to this one; things should become clearer after some
hands-on experience!</p>
<p>Also, this package makes heavy use of its sister package
<a href="https://docs.ropensci.org/rix/" class="external-link">rix</a>, and I highly recommend that you first get familiar
with <code>Nix</code> by using <a href="https://docs.ropensci.org/rix/" class="external-link">rix</a>. With
<a href="https://docs.ropensci.org/rix/" class="external-link">rix</a>, you’ll learn how to set up reproducible development
environments for data science, which you can use for interactive data
analysis work. Then, if you want to go one step further in the <a href="https://www.researchgate.net/figure/Reproducibility-spectrum-as-Peng-2011-stated_fig1_354765302" class="external-link">reproducibility
spectrum/continuum</a>, this is where <a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a> comes
in.</p>
<div class="section level2">
<h2 id="definitions">Definitions<a class="anchor" aria-label="anchor" href="#definitions"></a>
</h2>
<p>In <code>Nix</code> terminology, a derivation is <em>a specification
for running an executable on precisely defined input files to repeatably
produce output files at uniquely determined file system paths.</em> (<a href="https://nix.dev/manual/nix/2.25/language/derivations" class="external-link">source</a>)</p>
<p>In simpler terms, a derivation is a recipe with precisely defined
inputs, steps, and a fixed output. This means that given identical
inputs and build steps, the exact same output will always be produced.
To achieve this level of reproducibility, several important measures
must be taken:</p>
<ul>
<li>All inputs to a derivation must be explicitly declared.</li>
<li>Inputs include not just data files, but also software dependencies,
configuration flags, and environment variables, essentially anything
necessary for the build process.</li>
<li>The build process takes place in a <em>hermetic</em> sandbox to
ensure the exact same output is always produced.</li>
</ul>
<p>The next sections of this document explain these three points in more
detail.</p>
</div>
<div class="section level2">
<h2 id="derivations">Derivations<a class="anchor" aria-label="anchor" href="#derivations"></a>
</h2>
<p>Here is an example of a <em>simple</em> <code>Nix</code>
expression:</p>
<pre><code>let
 pkgs = import (fetchTarball "https://github.com/rstats-on-nix/nixpkgs/archive/2025-04-11.tar.gz") {};

in

pkgs.stdenv.mkDerivation {
  name = "filtered_mtcars";
  buildInputs = [ pkgs.gawk ];
  dontUnpack = true;
  src = ./mtcars.csv;
  installPhase = ''
    mkdir -p $out
    awk -F',' 'NR==1 || $9=="1" { print }' $src &gt; $out/filtered.csv
  '';
}</code></pre>
<p>I won’t go into details here, but what’s important is that this code
uses <code>awk</code>, a common Unix data processing tool, to filter the
<code>mtcars.csv</code> file to keep only rows where the 9th column (the
<code>am</code> column) equals 1. As you can see, a significant amount
of boilerplate code is required to perform this simple operation.
However, this approach is completely reproducible: the dependencies are
declared and pinned to a specific dated branch of our
<code>rstats-on-nix/nixpkgs</code> fork, and the only thing that could
make this pipeline fail (though it’s a bit of a stretch to call this a
<em>pipeline</em>) is if the <code>mtcars.csv</code> file is not
provided to it.</p>
<p>You could then add another step that uses <code>filtered.csv</code>
as input and continue processing it. If you label the above code as
<code>f</code> and a subsequent chunk of <code>Nix</code> code as
<code>g</code>, then adding another step would essentially result in the
following computation: <code>mtcars |&gt; f |&gt; g</code>, where
<code>f</code> and <code>g</code> are pure functions, and the pipeline
is thus a composition of pure functions.</p>
<p><code>Nix</code> builds <code>filtered.csv</code> in two steps: it
first generates a <em>derivation</em> from this expression, and only
then builds it. For clarity in this document, I’ll refer to code like
the example above as a <em>derivation</em> rather than an expression, to
avoid confusion with the concept of <em>expression</em> in R.</p>
<p>The goal of <a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a> is to help you write pipelines
like <code>mtcars |&gt; f |&gt; g</code> without needing to learn
<code>Nix</code>, while still benefiting from its powerful
reproducibility features.</p>
</div>
<div class="section level2">
<h2 id="dependencies-of-derivations">Dependencies of derivations<a class="anchor" aria-label="anchor" href="#dependencies-of-derivations"></a>
</h2>
<p><code>Nix</code> requires the dependencies of any derivation to be
explicitly listed and managed by <code>Nix</code> itself. If you’re
building output that requires, for example, Quarto, then Quarto must be
explicitly listed as an input, even if you already have Quarto installed
on your system. The same applies to Quarto’s dependencies, and all the
dependencies of those dependencies, all the way down to the common
ancestor of all packages. With <code>Nix</code>, to run a linear
regression with R, you essentially need to build the entire universe of
dependencies first.</p>
<p>In <code>Nix</code> terms, this complete set of packages and their
dependencies are what its author, Eelco Dolstra, refers to as
<em>component closures</em>:</p>
<blockquote>
<p>The idea is to always deploy component closures: if we deploy a
component, then we must also deploy its dependencies, their
dependencies, and so on. That is, we must always deploy a set of
components that is closed under the ‘’depends on’’ relation. Since
closures are self-contained, they are the units of complete software
deployment. After all, if a set of components is not closed, it is not
safe to deploy, since using them might cause other components to be
referenced that are missing on the target system.</p>
</blockquote>
<p>(<em>Nix: A Safe and Policy-Free System for Software Deployment</em>,
Dolstra et al., 2004).</p>
<p>The figure below, from the same paper, illustrates this idea:</p>
<figure><img src="https://raw.githubusercontent.com/b-rodrigues/rixpress/refs/heads/main/vignettes/figure_4.png" alt="Figure 4 of Dolstra et al. (2004)"><figcaption aria-hidden="true">
Figure 4 of Dolstra et al. (2004)
</figcaption></figure><p>In the figure, <code>subversion</code> depends on
<code>openssl</code>, which itself depends on <code>glibc</code>.
Similarly, if you write a derivation that builds a data frame by
filtering <code>mtcars</code>, this derivation requires:</p>
<ul>
<li>An input file, such as <code>mtcars.csv</code>.</li>
<li>R and potentially R packages like <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>.</li>
<li>All of R’s dependencies and the dependencies of any R packages.</li>
<li>The dependencies of those dependencies (all the way down).</li>
</ul>
<p>All of these must be managed by <code>Nix</code>. If any dependency
exists “outside” this component closure and is only available on your
machine, then the pipeline will only <em>work on your machine</em> -
defeating the purpose of reproducibility! (It should be noted, however,
that there are sometimes good reasons to have a dependency that is not
managed by <code>Nix</code>, in which case you might prefer to use
<a href="https://docs.ropensci.org/targets/" class="external-link">targets</a> running inside a Nix shell instead of
<a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a>, but these situations should be the exception
rather than the rule).</p>
<p><code>Nix</code> distinguishes between different types of
dependencies (<code>buildInputs</code>, <code>nativeBuildInputs</code>,
<code>propagatedBuildInputs</code>,
<code>propagatedNativeBuildInputs</code>), but let’s skip this concept,
which is only relevant for packaging upstream software, not for defining
our pipelines. But if you’re curious, read <a href="https://gist.github.com/b-rodrigues/c677b59126d05d43347ed9623ddd5b0c" class="external-link">this</a>.</p>
</div>
<div class="section level2">
<h2 id="the-nix-store-and-hermetic-builds">The <code>Nix</code> store and hermetic builds<a class="anchor" aria-label="anchor" href="#the-nix-store-and-hermetic-builds"></a>
</h2>
<p>When building derivations, their outputs are saved into the <em>Nix
store</em>. Typically located at <code>/nix/store/</code>, this folder
contains all the software and build artifacts produced by
<code>Nix</code>.</p>
<p>For example, if you write a derivation that computes the tail of a
file named <code>mtcars.csv</code>, once the derivation is built, its
output would be stored at a path like
<code>/nix/store/81k4s9q652jlka0c36khpscnmr8wk7jb-mtcars_tail</code>.
The long cryptographic hash uniquely identifies the build output and is
computed based on the content of the derivation along with all its
inputs and dependencies. This ensures that the build is fully
reproducible.</p>
<p>As a result, building the same derivation on two different machines
will yield the same cryptographic hash, and you can substitute the built
artifact with the derivation that generates it one-to-one. This is
analogous to mathematics: if you consider the function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">f(x):= x^2</annotation></semantics></math>,
then writing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(2)</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math>
represents the same value.</p>
<p>This mechanism is what makes it possible to import and export build
artifacts between pipelines to avoid having to rebuild everything from
scratch on different machines or on continuous integration platforms.
<a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a> has two functions that allow this, called
<code><a href="../reference/export_nix_archive.html">export_nix_archive()</a></code> and
<code><a href="../reference/import_nix_archive.html">import_nix_archive()</a></code>.</p>
<p>To ensure that building derivations always produces exactly the same
outputs, builds must occur in an isolated environment, often referred to
as a sandbox. This approach, known as a hermetic build process, ensures
that the build is unaffected by external factors or the state of the
host system.</p>
<p>This isolation extends to environment variables as well. For example,
R users might set the variable <code>JAVA_HOME</code> to make R aware of
where the Java runtime is installed. However, if Java is required for a
derivation, setting <code>JAVA_HOME</code> outside of the sandbox has no
effect; it must be explicitly set within the sandbox. This isolation
also means that if you need to access an API to download data, it won’t
work because no internet connection is allowed from within the build
sandbox.</p>
<p>This may seem very restrictive, but it makes perfect sense if your
goal is to achieve complete reproducibility. Consider a scenario where
you need to use a function <code>f()</code> to access an API to get data
for your analysis. What guarantee do you have that running
<code>f()</code> today will yield the same result as running
<code>f()</code> in six months or a year? Will the API even still be
online?</p>
<p>For true reproducibility, you should obtain the data from the API
once, then version and archive it, and continue using this archived data
for your analysis (and share it with anyone who might want to reproduce
your study).</p>
</div>
<div class="section level2">
<h2 id="summary-and-conclusion">Summary and conclusion<a class="anchor" aria-label="anchor" href="#summary-and-conclusion"></a>
</h2>
<p>As explained at the beginning of this vignette, <code>Nix</code>
generates a derivation from a <code>Nix</code> expression through a
process called instantiation. Writing a reproducible pipeline with
<code>Nix</code> directly would require writing very long and complex
<code>Nix</code> expressions. This is where <a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a>
comes in - it handles this complexity for you.</p>
<p>During instantiation, <code>Nix</code> processes your declarations,
resolves all inputs (including source files, build scripts, and external
dependencies), and computes a unique cryptographic hash. This hash is
derived from both the contents of your derivation and its entire
dependency graph, forming part of the derivation’s identity. This
ensures that even the smallest change in your inputs will result in a
distinct derivation, guaranteeing reproducibility. To avoid confusion
with the concept of expression in R, throughout this documentation I
refer to <code>Nix</code> expressions as <em>derivations</em>.</p>
<p>Once instantiated, derivations can be built. During the build
process, <code>Nix</code> constructs an isolated, hermetic environment
where only the explicitly declared dependencies are available. This
makes the build entirely deterministic, meaning that identical inputs
always produce identical outputs, regardless of the machine or
environment. This isolation improves reliability and facilitates
debugging and maintenance by eliminating external variables.</p>
<p>After a successful build, <code>Nix</code> stores the output in the
<code>Nix</code> store (typically at <code>/nix/store/</code>). For
example, if you build a derivation that processes the
<code>mtcars.csv</code> file, the output might be saved under a unique
path like
<code>/nix/store/81k4s9q652jlka0c36khpscnmr8wk7jb-mtcars_tail</code>.
The cryptographic hash is computed based on the derivation’s inputs and
build process. If <em>anything</em> changes, the hash will be different.
This is extremely precise - even changing the separator in the
<code>mtcars.csv</code> data set from <code>,</code> to <code>|</code>
will result in a different hash, even though the resulting
<code>mtcars_tail</code> object might look identical to us. From
<code>Nix</code>’s perspective, they’re different because one of the
inputs was different.</p>
<p>The key takeaway is that <code>Nix</code> is a complex tool because
it solves a complex problem: ensuring complete reproducibility across
different environments and time. <a href="https://github.com/b-rodrigues/rixpress/" class="external-link">rixpress</a> and
<a href="https://docs.ropensci.org/rix/" class="external-link">rix</a> are packages designed to make <code>Nix</code> more
accessible to R users, allowing you to benefit from <code>Nix</code>’s
reproducibility without having to learn all its complexities.</p>
<p>Now that you’re familiar with the basic <code>Nix</code> concepts,
let’s move on to the next vignette where you’ll set up your first basic
pipeline: <code><a href="../articles/b-core-functions.html">vignette("b-core-functions")</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bruno Rodrigues.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
